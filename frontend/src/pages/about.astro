---
/**
 * About Page - Editorial layout with dynamic CMS sections
 * Matches PDF design with photo collages, quotes, and two-column layouts
 */
import BaseLayout from '@layouts/BaseLayout.astro';
import { sanityClient as client } from 'sanity:client';
import { aboutPageQuery } from '@lib/sanity/queries';

// Import hero component (standard across internal pages)
import InternalPageHero from '@components/sections/InternalPageHero.astro';

// Import section components
import AboutSectionTitle from '@components/sections/about/AboutSectionTitle.astro';
import AboutCenteredText from '@components/sections/about/AboutCenteredText.astro';
import AboutTwoColumn from '@components/sections/about/AboutTwoColumn.astro';
import AboutQuoteBanner from '@components/sections/about/AboutQuoteBanner.astro';
import AboutFullWidthImage from '@components/sections/about/AboutFullWidthImage.astro';
import AboutTwoPhotos from '@components/sections/about/AboutTwoPhotos.astro';
import AboutTextWrap from '@components/sections/about/AboutTextWrap.astro';
import AboutTitleWithSideImage from '@components/sections/about/AboutTitleWithSideImage.astro';

// Fetch page data from Sanity
const page = await client.fetch(aboutPageQuery);

if (!page) {
  return Astro.redirect('/404');
}

const title = page.title || 'About';
const description =
  page.metaDescription ||
  'Learn more about Weemston Consulting and Jessica Weeman.';

// Map section types to components
const sectionComponents: Record<string, any> = {
  sectionTitle: AboutSectionTitle,
  centeredText: AboutCenteredText,
  twoColumn: AboutTwoColumn,
  quoteBanner: AboutQuoteBanner,
  fullWidthImage: AboutFullWidthImage,
  twoPhotos: AboutTwoPhotos,
  textWrap: AboutTextWrap,
  titleWithSideImage: AboutTitleWithSideImage,
};
---

<BaseLayout title={title} description={description}>
  {/* Hero Section */}
  <InternalPageHero
    heading={page.heroHeading}
    headingHighlight={page.heroHeadingHighlight}
    highlightColorType={page.heroHighlightColorType}
    highlightColorShade={page.heroHighlightColorShade}
    highlightCustomColor={page.heroHighlightCustomColor}
    showDivider={page.heroShowDivider}
    dividerColorType={page.heroDividerColorType}
    dividerColorShade={page.heroDividerColorShade}
    dividerCustomColor={page.heroDividerCustomColor}
    tagline={page.heroTagline}
    taglineColor={page.heroTaglineColor}
    backgroundColorType={page.heroBackgroundColorType}
    backgroundColorMode={page.heroBackgroundColorMode}
    backgroundColorShade={page.heroBackgroundColorShade}
    backgroundCustomColor={page.heroBackgroundCustomColor}
    backgroundGradient={page.heroBackgroundGradient}
  />

  <div class="about-page">
    {
      page.sections?.map((section: any) => {
        const Component = sectionComponents[section._type];
        if (!Component) {
          console.warn(`Unknown section type: ${section._type}`);
          return null;
        }
        return <Component {...section} />;
      })
    }
  </div>
</BaseLayout>

<style is:global>
  .about-page {
    display: flex;
    flex-direction: column;
    gap: var(--space-2xl);
  }

  .about-page > section:first-of-type {
    padding-top: var(--space-2xl);
  }

  .about-page > section:last-of-type {
    padding-bottom: var(--space-2xl);
  }
</style>
