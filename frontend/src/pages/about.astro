---
import BaseLayout from '@layouts/BaseLayout.astro';
import { sanityClient as client } from 'sanity:client';
import { aboutPageQuery } from '@lib/sanity/queries';
import InternalPageHero from '@components/sections/InternalPageHero.astro';
import AboutSection from '@components/sections/AboutSection.astro';
import AboutTrustedBy from '@components/sections/AboutTrustedBy.astro';

const page = await client.fetch(aboutPageQuery);

if (!page) {
  return Astro.redirect('/404');
}
---

<BaseLayout title={page.title} description={page.metaDescription}>
  {/* Hero Section */}
  <InternalPageHero
    heading={page.heroHeading}
    headingHighlight={page.heroHeadingHighlight}
    highlightColorType={page.heroHighlightColorType}
    highlightColorShade={page.heroHighlightColorShade}
    highlightCustomColor={page.heroHighlightCustomColor}
    showDivider={page.heroShowDivider}
    dividerColorType={page.heroDividerColorType}
    dividerColorShade={page.heroDividerColorShade}
    dividerCustomColor={page.heroDividerCustomColor}
    tagline={page.heroTagline}
    taglineColor={page.heroTaglineColor}
    backgroundColorType={page.heroBackgroundColorType}
    backgroundColorMode={page.heroBackgroundColorMode}
    backgroundColorShade={page.heroBackgroundColorShade}
    backgroundCustomColor={page.heroBackgroundCustomColor}
    backgroundGradient={page.heroBackgroundGradient}
  />

  {/* About Sections */}
  {
    page.aboutSections &&
      page.aboutSections.length > 0 &&
      page.aboutSections.map(
        (
          section: {
            _key: string;
            title: string;
            description?: any[];
            images?: any[];
            backgroundColorMode?: 'solid' | 'gradient';
            backgroundColorType?: string;
            backgroundColorShade?: number;
            backgroundCustomColor?: { label?: string; value: string };
            backgroundGradient?: any;
            titleColorType?: string;
            titleColorShade?: number;
            titleCustomColor?: { label?: string; value: string };
            descriptionTextColor?: 'base' | 'muted' | 'contrast';
          },
          index: number
        ) => (
          <AboutSection
            sectionIndex={index}
            title={section.title}
            {...(section.description && { description: section.description })}
            {...(section.images && { images: section.images })}
            {...(section.backgroundColorMode && {
              backgroundColorMode: section.backgroundColorMode,
            })}
            {...(section.backgroundColorType && {
              backgroundColorType: section.backgroundColorType,
            })}
            {...(section.backgroundColorShade !== undefined && {
              backgroundColorShade: section.backgroundColorShade,
            })}
            {...(section.backgroundCustomColor && {
              backgroundCustomColor: section.backgroundCustomColor,
            })}
            {...(section.backgroundGradient && {
              backgroundGradient: section.backgroundGradient,
            })}
            {...(section.titleColorType && {
              titleColorType: section.titleColorType,
            })}
            {...(section.titleColorShade !== undefined && {
              titleColorShade: section.titleColorShade,
            })}
            {...(section.titleCustomColor && {
              titleCustomColor: section.titleCustomColor,
            })}
            {...(section.descriptionTextColor && {
              descriptionTextColor: section.descriptionTextColor,
            })}
          />
        )
      )
  }

  {/* Trusted By Section */}
  {
    page.trustedByCaseStudies && page.trustedByCaseStudies.length > 0 && (
      <AboutTrustedBy
        title={page.trustedByTitle}
        showTitle={page.trustedByShowTitle}
        titleColorType={page.trustedByTitleColorType}
        titleColorShade={page.trustedByTitleColorShade}
        titleCustomColor={page.trustedByTitleCustomColor}
        caseStudies={page.trustedByCaseStudies}
        backgroundColorType={page.trustedByBackgroundColorType}
        backgroundColorMode={page.trustedByBackgroundColorMode}
        backgroundColorShade={page.trustedByBackgroundColorShade}
        backgroundCustomColor={page.trustedByBackgroundCustomColor}
        backgroundGradient={page.trustedByBackgroundGradient}
      />
    )
  }
</BaseLayout>
