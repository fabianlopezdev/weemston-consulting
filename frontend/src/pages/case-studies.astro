---
import BaseLayout from '@layouts/BaseLayout.astro';
import { sanityClient as client } from 'sanity:client';
import { caseStudiesPageQuery } from '@lib/sanity/queries';
import HeroSection from '@components/sections/HeroSection.astro';
import SectionRenderer from '@components/sections/SectionRenderer.astro';

const lang = Astro.locals.lang || 'en';
const caseStudiesPage = await client.fetch(caseStudiesPageQuery, {
  documentId: `caseStudiesPage-${lang}`,
});

if (!caseStudiesPage) {
  return Astro.redirect('/404');
}

// Filter enabled sections
const visibleSections =
  caseStudiesPage.sections?.filter((section: any) => section.enabled) || [];
---

<BaseLayout
  title={caseStudiesPage.title}
  description={caseStudiesPage.metaDescription}
>
  {caseStudiesPage.hero && <HeroSection {...caseStudiesPage.hero} />}

  {visibleSections.map((section: any) => <SectionRenderer section={section} />)}
</BaseLayout>
