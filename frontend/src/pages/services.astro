---
import BaseLayout from '@layouts/BaseLayout.astro';
import { sanityClient as client } from 'sanity:client';
import { servicesPageNewQuery } from '@lib/sanity/queries';
import ServicesHero from '@components/sections/ServicesHero.astro';
import ServiceSection from '@components/sections/ServiceSection.astro';

const page = await client.fetch(servicesPageNewQuery);

if (!page) {
  return Astro.redirect('/404');
}
---

<BaseLayout title={page.title} description={page.metaDescription}>
  {/* Hero Section */}
  <ServicesHero
    heading={page.heroHeading}
    headingHighlight={page.heroHeadingHighlight}
    highlightColorType={page.heroHighlightColorType}
    highlightColorShade={page.heroHighlightColorShade}
    highlightCustomColor={page.heroHighlightCustomColor}
    showDivider={page.heroShowDivider}
    dividerColorType={page.heroDividerColorType}
    dividerColorShade={page.heroDividerColorShade}
    dividerCustomColor={page.heroDividerCustomColor}
    tagline={page.heroTagline}
    taglineColor={page.heroTaglineColor}
    backgroundColorType={page.heroBackgroundColorType}
    backgroundColorShade={page.heroBackgroundColorShade}
    backgroundCustomColor={page.heroBackgroundCustomColor}
  />

  {/* Service Sections */}
  {
    page.serviceSections &&
      page.serviceSections.length > 0 &&
      page.serviceSections.map((section: any) => (
        <ServiceSection
          tag={section.tag}
          title={section.title}
          leadText={section.leadText}
          description={section.description}
          listStyle={section.listStyle}
          listTitle={section.listTitle}
          listItems={section.listItems}
          caseStudiesLinkText={section.caseStudiesLinkText}
          caseStudiesLink={section.caseStudiesLink}
          icon={section.icon}
          imagePosition={section.imagePosition}
          backgroundColor={section.backgroundColor}
        />
      ))
  }
</BaseLayout>
