---
import BaseLayout from '@layouts/BaseLayout.astro';
import { sanityClient as client } from 'sanity:client';
import { allBlogPostsQuery } from '@lib/sanity/queries';
import { createTranslator } from '@lib/i18n/translations';
import Image from '@components/media/Image.astro';

const lang = Astro.locals.lang || 'en';
const t = createTranslator(lang);
const posts = await client.fetch(allBlogPostsQuery, { language: lang });
---

<BaseLayout title={t('seo.blog_title')}>
  <div class="container">
    <h1>{t('nav.blog')}</h1>
    <div class="blog-grid">
      {
        posts.map((post) => (
          <article class="blog-card">
            {post.mainImage && (
              <Image
                image={post.mainImage}
                alt={post.mainImage.alt}
                width={400}
                class="blog-image"
              />
            )}
            <div class="blog-content">
              <h2>
                <a href={`/blog/${post.slug.current}`}>{post.title}</a>
              </h2>
              {post.excerpt && <p>{post.excerpt}</p>}
              <time datetime={post.publishedAt}>
                {new Date(post.publishedAt).toLocaleDateString()}
              </time>
            </div>
          </article>
        ))
      }
    </div>
  </div>
</BaseLayout>

<style>
  .blog-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: var(--space-xl);
    margin-block-start: var(--space-xl);
  }

  .blog-card {
    border: var(--border-width-thin) solid var(--color-border);
    border-radius: var(--border-radius-md);
    overflow: hidden;
  }

  .blog-content {
    padding: var(--space-lg);
  }

  time {
    font-size: var(--font-size-sm);
    color: var(--color-text-muted);
  }
</style>
