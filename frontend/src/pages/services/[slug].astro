---
import type { GetStaticPaths } from 'astro';
import BaseLayout from '@layouts/BaseLayout.astro';
import { sanityClient as client } from 'sanity:client';
import { serviceQuery, allServicesQuery } from '@lib/sanity/queries';

export const getStaticPaths = (async () => {
  const services = await client.fetch(allServicesQuery, { language: 'en' });
  return services.map((service) => ({
    params: { slug: service.slug.current },
  }));
}) satisfies GetStaticPaths;

const { slug } = Astro.params;
const lang = Astro.locals.lang || 'en';
const service = await client.fetch(serviceQuery, { slug, language: lang });

if (!service) {
  return Astro.redirect('/404');
}
---

<BaseLayout
  title={service.seo?.metaTitle || service.title}
  description={service.seo?.metaDescription || service.description}
>
  <article class="container">
    <h1>{service.title}</h1>
    <p class="description">{service.description}</p>

    {
      service.features && service.features.length > 0 && (
        <ul class="features">
          {service.features.map((feature) => (
            <li>{feature}</li>
          ))}
        </ul>
      )
    }

    <!-- Render portable text content here -->
  </article>
</BaseLayout>

<style>
  h1 {
    margin-block-end: var(--space-md);
  }

  .description {
    font-size: var(--font-size-lg);
    color: var(--color-text-muted);
    margin-block-end: var(--space-lg);
  }

  .features {
    margin-block: var(--space-lg);
  }
</style>
