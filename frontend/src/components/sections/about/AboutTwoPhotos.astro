---
/**
 * AboutTwoPhotos - Two photos side by side
 */
import Image from '@components/media/Image.astro';
import { resolveColorSelection } from '@lib/sanity/colorResolver';
import { sanityClient as client } from 'sanity:client';
import { siteSettingsQuery } from '@lib/sanity/queries';
import type { SanityImageSource } from '@sanity/image-url/lib/types/types';

interface ColorData {
  label?: string;
  value: string;
}

interface GradientColorData {
  colorType?: 'primary' | 'secondary' | 'accent' | 'custom';
  shade?: number;
  customColor?: ColorData;
}

interface GradientData {
  direction?: string;
  startColor?: GradientColorData;
  endColor?: GradientColorData;
}

interface ImageData {
  asset: SanityImageSource;
  alt?: string;
  hotspot?: { x: number; y: number };
  crop?: { top: number; bottom: number; left: number; right: number };
}

interface Props {
  images?: ImageData[];
  backgroundColorMode?: 'solid' | 'gradient';
  backgroundColorType?:
    | 'default'
    | 'primary'
    | 'secondary'
    | 'accent'
    | 'custom';
  backgroundColorShade?: number;
  backgroundCustomColor?: ColorData;
  backgroundGradient?: GradientData;
}

const {
  images = [],
  backgroundColorMode = 'solid',
  backgroundColorType = 'default',
  backgroundColorShade = 95,
  backgroundCustomColor,
  backgroundGradient,
} = Astro.props;

// Fetch site settings for colors
const settings = await client.fetch(siteSettingsQuery);
const siteColors = settings?.colors;

// Resolve background color
let backgroundColor = 'transparent';
if (backgroundColorType !== 'default') {
  backgroundColor =
    backgroundColorMode === 'gradient' && backgroundGradient
      ? `linear-gradient(${backgroundGradient.direction || '135deg'}, ${resolveColorSelection(backgroundGradient.startColor, siteColors)}, ${resolveColorSelection(backgroundGradient.endColor, siteColors)})`
      : resolveColorSelection(
          {
            colorType: backgroundColorType,
            shade: backgroundColorShade,
            customColor: backgroundCustomColor,
          },
          siteColors
        );
}

const cssVars = [`--two-photos-bg: ${backgroundColor}`].join('; ');
---

<section class="two-photos" style={cssVars}>
  <div class="container">
    {
      images[0] && images[1] && (
        <div class="two-photos__grid">
          <figure class="two-photos__image">
            <Image
              image={images[0]}
              alt={images[0].alt || 'Photo 1'}
              sizes="(max-width: 768px) 100vw, 50vw"
            />
          </figure>
          <figure class="two-photos__image">
            <Image
              image={images[1]}
              alt={images[1].alt || 'Photo 2'}
              sizes="(max-width: 768px) 100vw, 50vw"
            />
          </figure>
        </div>
      )
    }
  </div>
</section>

<style>
  .two-photos {
    background: var(--two-photos-bg);
  }

  .container {
    max-width: var(--container-max-width);
    margin-inline: auto;
    padding-inline: var(--container-padding);
  }

  .two-photos__grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--space-xl);
  }

  @media (min-width: 640px) {
    .two-photos__grid {
      grid-template-columns: 1fr 1fr;
      gap: var(--space-2xl);
    }
  }

  .two-photos__image {
    margin: 0;
    overflow: hidden;
    border-radius: var(--border-radius-md);
    aspect-ratio: 4 / 3;
  }

  .two-photos__image :global(img),
  .two-photos__image :global(.image-blur-wrapper) {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }

  .two-photos__image:hover :global(img) {
    transform: scale(1.03);
  }
</style>

<script>
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  const prefersReducedMotion = window.matchMedia(
    '(prefers-reduced-motion: reduce)'
  ).matches;

  if (!prefersReducedMotion) {
    const sections = gsap.utils.toArray('.two-photos') as HTMLElement[];
    sections.forEach((section) => {
      const images = section.querySelectorAll('.two-photos__image');

      // Animate images
      if (images.length) {
        gsap.from(images, {
          scrollTrigger: {
            trigger: section,
            start: 'top 80%',
            once: true,
          },
          opacity: 0,
          y: 30,
          duration: 0.7,
          stagger: 0.15,
          ease: 'power2.out',
        });
      }
    });
  }
</script>
