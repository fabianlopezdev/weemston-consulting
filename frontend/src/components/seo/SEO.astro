---
import { SEO as AstroSEO } from 'astro-seo';
import { getAbsoluteUrl } from '@lib/utils/url';
import { getAlternateLinks } from '@lib/i18n/hreflang';

export interface Props {
  title: string;
  description?: string;
  image?: string;
  noIndex?: boolean;
  article?: {
    publishedTime?: string;
    modifiedTime?: string;
    authors?: string[];
    tags?: string[];
  };
}

const { title, description, image, noIndex = false, article } = Astro.props;

const currentUrl = Astro.url.pathname;
const canonicalUrl = getAbsoluteUrl(currentUrl);
const alternateLinks = getAlternateLinks(currentUrl);

const ogImage = image ? getAbsoluteUrl(image) : undefined;
---

<AstroSEO
  title={title}
  {...description ? { description } : {}}
  canonical={canonicalUrl}
  noindex={noIndex}
  nofollow={noIndex}
  openGraph={{
    basic: {
      title,
      type: article ? 'article' : 'website',
      image: ogImage || '',
      url: canonicalUrl,
    },
    optional: {
      ...(description ? { description } : {}),
      siteName: title,
    },
    ...(ogImage ? { image: { url: ogImage } } : {}),
    ...(article
      ? {
          article: {
            ...(article.publishedTime
              ? { publishedTime: article.publishedTime }
              : {}),
            ...(article.modifiedTime
              ? { modifiedTime: article.modifiedTime }
              : {}),
            ...(article.authors ? { authors: article.authors } : {}),
            ...(article.tags ? { tags: article.tags } : {}),
          },
        }
      : {}),
  }}
  twitter={ogImage
    ? {
        card: 'summary_large_image' as const,
        title,
        ...(description ? { description } : {}),
        image: ogImage,
      }
    : {
        card: 'summary' as const,
        title,
        ...(description ? { description } : {}),
      }}
  extend={{
    link: alternateLinks.map((link) => ({
      rel: 'alternate',
      hreflang: link.lang,
      href: link.href,
    })),
    meta: [
      {
        name: 'viewport',
        content: 'width=device-width, initial-scale=1.0',
      },
      {
        name: 'theme-color',
        content: '#ffffff',
      },
    ],
  }}
/>
